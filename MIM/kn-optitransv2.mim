;; kn-optitransv2.mim -- Kannada input method.
;; Copyright (C) 2015  Vishvas Vasuki  <vishvas.vasuki@gmail.com>

;; This file is part of the m17n database; a sub-part of the m17n
;; library.

;; The m17n library is free software; you can redistribute it and/or
;; modify it under the terms of the GNU Lesser General Public License
;; as published by the Free Software Foundation; either version 2.1 of
;; the License, or (at your option) any later version.

;; The m17n library is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
;; Lesser General Public License for more details.

;; You should have received a copy of the GNU Lesser General Public
;; License along with the m17n library; if not, write to the Free
;; Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
;; Boston, MA 02110-1301, USA.

(input-method kn optitransv2)

(description "Kannada input method by the OPTITRANS
transliteration system. 

0. A major deviation from other transliteration systems like ITRANS and HK
is that latin consonants are mapped to the correpsonding devanAgarI consonant *followed by the 
vowel a*. For example, k maps to ‡≤ï, not ‡≤ï‡≥ç.

1. panchama-varNa-s of vyanjana-varga-s 
  nnk->‡≤ô‡≥ç‡≤ï, nnkh->‡≤ô‡≥ç‡≤ñ, nng->‡≤ô‡≥ç‡≤ó, nngh->‡≤ô‡≥ç‡≤ò
  nnch->‡≤û‡≥ç‡≤ö, nnCh->‡≤û‡≥ç‡≤õ, nnc->‡≤û‡≥ç‡≤ö, nnC->‡≤û‡≥ç‡≤õ,

2. Any common consonant, typed twice, yields that consonant with the virAma. So, nn yields ‡≤®‡≥ç. The rationale is that a repeated consonant such as ‡≤®‡≤® and ‡≤¶‡≤¶ is far less common than the consonants with a virAma, such as ‡≤®‡≥ç and ‡≤¶‡≥ç.

3. The rare character sequences that conflict with shortcuts for more frequently occuring strings can be typed using the "commit key" - (Ctrl + Shift  + Enter), or with the use of the arrow key. 
For example, sh yields ‡≤∂. But if one wanted to type ‡≤∏‡≤π, one can type: s<Commit key>h or s<left arrow, right arrow>h.

Examples:
- Avoiding unnecessary 'a'-s.
  - kml or kamala - ‡≤ï‡≤Æ‡≤≤ 
- Typing vyanjana-s with a virAma
  - sikkt - ‡≤∏‡≤ø‡≤ï‡≥ç‡≤§
  - sik;t - ‡≤∏‡≤ø‡≤ï‡≥ç‡≤§
- Shortcut for typing panchama-s/ anunAsika-s of vargIya-vyanjana-s
  - shankara or shnnkr- ‡≤∂‡≤ô‡≥ç‡≤ï‡≤∞‡•§
  - snncit - ‡≤∏‡≤û‡≥ç‡≤ö‡≤ø‡≤§
  - shann karoti - ‡≤∂‡≤ô‡≥ç ‡≤ï‡≤∞‡≥ã‡≤§‡≤ø‡•§
- Overriding shortcuts
  - pashyann  karoti - ‡≤™‡≤∂‡≥ç‡≤Ø‡≤®‡≥ç ‡≤ï‡≤∞‡≥ã‡≤§‡≤ø‡•§ (Note two spaces here. Avoids ‡≤™‡≤∂‡≥ç‡≤Ø‡≤ô‡≥ç ‡≤ï‡≤∞‡≥ã‡≤§‡≤ø )
  - s<Commit key>h or s<left arrow, right arrow>h or sah or saha - ‡≤∏‡≤π (Avoids ‡≤∂)


The motivation behind additions made to the basic ITRANS scheme
is described in https://sites.google.com/site/sanskritcode/optitrans,
along with a tabulated comparison with several other
transliteration schemes.

Also, see: http://en.wikipedia.org/wiki/Devanagari_transliteration.")

(title "‡≤ï")

(map
 (non_init_keys
  (".") (";") ("~") ("$")
  ("A") ("B") ("C") ("D") ("E") ("F") ("G") ("H") ("I") ("J") ("K") ("L")
  ("M") ("N") ("O") ("P") ("Q") ("R") ("S") ("T") ("U") ("V") ("W") ("X") ("Y") ("Z") 
  ("a") ("b") ("c") ("d") ("e") ("f") ("g") ("h") ("i")
  ("j") ("k") ("l") ("m") ("n") ("o") ("p") ("q") ("r")
  ("s") ("t") ("u") ("v") ("w") ("x") ("y") ("z")
  )

 (consonant
  ("k" "‡≤ï")
  ("kh" "‡≤ñ")
  ("K" "‡≤ñ")
  ("g" "‡≤ó")
  ("gh" "‡≤ò")
  ("G" "‡≤ò")
  (".k" "‡≤ï‡≤º")
  (".kh" "‡≤ñ‡≤º")
  (".K" "‡≤ñ‡≤º")
  (".g" "‡≤ó‡≤º")
  ("~N" "‡≤ô")
  ("N^" "‡≤ô")
  ("ch" "‡≤ö")
  ("Ch" "‡≤õ")
  ("c" "‡≤ö")
  ("C" "‡≤õ")
  ("chh" "‡≤õ")
  ("j" "‡≤ú")
  ("jh" "‡≤ù")
  ("J" "‡≤ù")
  ("~n" "‡≤û")
  ("JN" "‡≤û")
  ("T" "‡≤ü")
  ("Th" "‡≤†")
  ("D" "‡≤°")
  ("Dh" "‡≤¢")
  (".D" "‡≤°‡≤º")
  (".Dh" "‡≤¢‡≤º")
  ("N" "‡≤£")
  ("t" "‡≤§")
  ("th" "‡≤•")
  ("d" "‡≤¶")
  ("dh" "‡≤ß")
  ("n" "‡≤®")
  ("p" "‡≤™")
  ("ph" "‡≤´")
  ("P" "‡≤´")
  (".ph" "‡≤´‡≤º")
  ("f" "‡≤´‡≤º")
  ("b" "‡≤¨")
  ("bh" "‡≤≠")
  ("B" "‡≤≠")
  ("m" "‡≤Æ")
  ("y" "‡≤Ø")
  ("r" "‡≤∞")
  ("l" "‡≤≤")
  ("L" "‡≤≥")
  ("v" "‡≤µ")
  ("w" "‡≤µ")
  ("sh" "‡≤∂")
  ("Z" "‡•õ")
  (".j" "‡≤ú‡≤º")
  ("z" "‡≤∂")
  ("S" "‡≤∑")
  ("Sh" "‡≤∑")
  ("shh" "‡≤∑")
  ("s" "‡≤∏")
  ("h" "‡≤π")
  ("ttr" "‡≤§‡≥ç‡≤∞")
  ("jjn" "‡≤ú‡≥ç‡≤û")
  ("j~n" "‡≤ú‡≥ç‡≤û")
  ("x" "‡≤ï‡≥ç‡≤∑")

  ; nn shortcuts
  ("nnk" "‡≤ô‡≥ç" (pushback 1))
  ("nnx" "‡≤ô‡≥ç" (pushback 1))
  ("nnkh" "‡≤ô‡≥ç" (pushback 1))
  ("nnK" "‡≤ô‡≥ç" (pushback 1))
  ("nng" "‡≤ô‡≥ç" (pushback 1))
  ("nngh" "‡≤ô‡≥ç" (pushback 1))
  ("nnG" "‡≤ô‡≥ç" (pushback 1))
  ("nnch" "‡≤û‡≥ç" (pushback 1))
  ("nnCh" "‡≤û‡≥ç" (pushback 1))
  ("nnc" "‡≤û‡≥ç" (pushback 1))
  ("nnC" "‡≤û‡≥ç" (pushback 1))
  ("nnj" "‡≤û‡≥ç" (pushback 1))
  ("nnjh" "‡≤û‡≥ç" (pushback 1))
  ("nnJ" "‡≤û‡≥ç" (pushback 1))

  ("nnT" "‡≤£‡≥ç" (pushback 1))
  ("nnTh" "‡≤£‡≥ç" (pushback 1))
  ("nnD" "‡≤£‡≥ç" (pushback 1))
  ("nnDh" "‡≤£‡≥ç" (pushback 1))

  ) ; consonant ends

(consonant_with_space
  ("nn " "‡≤®‡≥ç ")
  ("nn  " "‡≤®‡≥ç ") ; handle the case where the transformation to ‡≤ô‡≥ç etc.. is not desired, even when followed by a character like k.
  ("nn k" "‡≤ô‡≥ç " (pushback 1))
  ("nn x" "‡≤ô‡≥ç " (pushback 1))
  ("nn K" "‡≤ô‡≥ç " (pushback 1))
  ("nn g" "‡≤ô‡≥ç " (pushback 1))
  ("nn G" "‡≤ô‡≥ç " (pushback 1))
  ("nn c" "‡≤û‡≥ç " (pushback 1))
  ("nn C" "‡≤û‡≥ç " (pushback 1))
  ("nn j" "‡≤û‡≥ç " (pushback 1))
  ("nn J" "‡≤û‡≥ç " (pushback 1))

  ("nn T" "‡≤£‡≥ç " (pushback 1))
  ("nn D" "‡≤£‡≥ç " (pushback 1))
  ) ; consonant_with_space ends

(consonant_with_viraama
  ; virAma shortcuts
  ("kk" "‡≤ï‡≥ç")
  ("khkh" "‡≤ñ‡≥ç")
  ("KK" "‡≤ñ‡≥ç")
  ("gg" "‡≤ó‡≥ç")
  ("ghgh" "‡≤ò‡≥ç")
  ("GG" "‡≤ò‡≥ç")
  ("~N~N" "‡≤ô‡≥ç")
  ("chch" "‡≤ö‡≥ç")
  ("ChCh" "‡≤õ‡≥ç")
  ("cc" "‡≤ö‡≥ç")
  ("CC" "‡≤õ‡≥ç")
  ("jj" "‡≤ú‡≥ç")
  ("jhjh" "‡≤ù‡≥ç")
  ("JJ" "‡≤ù‡≥ç")
  ("~n~n" "‡≤û‡≥ç")
  ("JNJN" "‡≤û‡≥ç")
  ("TT" "‡≤ü‡≥ç")
  ("ThTh" "‡≤†‡≥ç")
  ("DD" "‡≤°‡≥ç")
  ("DhDh" "‡≤¢‡≥ç")
  ("NN" "‡≤£‡≥ç")
  ("tt" "‡≤§‡≥ç")
  ("thth" "‡≤•‡≥ç")
  ("dd" "‡≤¶‡≥ç")
  ("dhdh" "‡≤ß‡≥ç")
  ("nn" "‡≤®‡≥ç")
  ("pp" "‡≤™‡≥ç")
  ("phph" "‡≤´‡≥ç")
  ("PP" "‡≤´‡≥ç")
  ("FF" "‡≤´‡§º‡≥ç")
  ("bb" "‡≤¨‡≥ç")
  ("bhbh" "‡≤≠‡≥ç")
  ("BB" "‡≤≠‡≥ç")
  ("mm" "‡≤Æ‡≥ç")
  ("M" "‡≤Ç")
  ("MM" "‡≤Æ‡≥ç")
  ("yy" "‡≤Ø‡≥ç")
  ("rr" "‡≤∞‡≥ç")
  ("ll" "‡≤≤‡≥ç")
  ("LL" "‡≤≥‡≥ç")
  ("vv" "‡≤µ‡≥ç")
  ("shsh" "‡≤∂‡≥ç")
  ("zz" "‡≤∂‡≥ç")
  ("SS" "‡≤∑‡≥ç")
  ("ShSh" "‡≤∑‡≥ç")
  ("ss" "‡≤∏‡≥ç")
  ("hh" "‡≤π‡≥ç")
  ("xx" "‡≤ï‡≥ç‡≤∑‡≥ç")
  ) ; consonant_with_viraama ends

 (independent
  ("a" "‡≤Ö")
  ("aa" "‡≤Ü")
  ("A" "‡≤Ü")
  ("i" "‡≤á")
  ("ii" "‡≤à")
  ("I" "‡≤à")
  ("u" "‡≤â")
  ("uu" "‡≤ä")
  ("U" "‡≤ä")
  ("R" "‡≤ã")
  ("RRi" "‡≤ã")
  ("R^i" "‡≤ã")
  ("LLi" "‡≤å")
  ("L^i" "‡≤å")
  ("e" "‡≤é")
  ("ee" "‡≤è")
  ("E" "‡≤è")
  ("ai" "‡≤ê")
  ("o" "‡≤í")
  ("oo" "‡≤ì")
  ("O" "‡≤ì")
  ("au" "‡≤î")
  ("RRI" "‡≥†")
  ("RR" "‡≥†")
  ("R^I" "‡≥†")
  ("LLI" "‡≥°")
  ("L^I" "‡≥°")
  ("AUM" "‡≤ì‡≤Ç")
  ("OM" "‡≤ì‡≤Ç")
  
  (".a" "‡≤Ω")
  ((S-\ ) "‚Äå")
  ((C-@) "‚Äç")) ; independent ends

 (ayogavAhas
  ; Visarga and the like may appear after a vowel. So, they aren't expected just in the dependent state.
  (".N" "‡§Å") ; TODO: Change to kn glyph.
  ("M" "‡≤Ç")
  ("H" "‡≤É")
  ("HH" "·≥≤")  ; ardhavisarga - often used to denote jihvAmUlIya and upadhmAnIya. 
 ) ; ayogavAhas end

 (ayogavAhas_with_consonant
   ; jihvAmUlIya and upadhmAnIya shortcuts
  ("Hk" "‡≥±" (pushback 1))
  ("Hp" "‡≥≤" (pushback 1))
  ("Hkh" "‡≥±" (pushback 1)) 
  ("Hph" "‡≥≤" (pushback 1))
  ("HK" "‡≥±" (pushback 1)) 
  ("HP" "‡≥≤" (pushback 1))
  ) ; ayogavAhas_with_consonant ends

 
 (digit
  ("0" "‡≥¶")
  ("1" "‡≥ß")
  ("2" "‡≥®")
  ("3" "‡≥©")
  ("4" "‡≥™")
  ("5" "‡≥´")
  ("6" "‡≥¨")
  ("7" "‡≥≠")
  ("8" "‡≥Æ")
  ("9" "‡≥Ø")
  ((KP_0) "‡≥¶")
  ((KP_1) "‡≥ß")
  ((KP_2) "‡≥®")
  ((KP_3) "‡≥©")
  ((KP_4) "‡≥™")
  ((KP_5) "‡≥´")
  ((KP_6) "‡≥¨")
  ((KP_7) "‡≥≠")
  ((KP_8) "‡≥Æ")
  ((KP_9) "‡≥Ø")) ; digit ends

 (udattta
  ("_" "‡•í")
  ("''" "‡•ë"))

 (dependent
  ("a" "")
  ("aa" "‡≤æ")
  ("A" "‡≤æ")
  ("i" "‡≤ø")
  ("ii" "‡≥Ä")
  ("I" "‡≥Ä")
  ("u" "‡≥Å")
  ("uu" "‡≥Ç")
  ("U" "‡≥Ç")
  ("R" "‡≥É")
  ("RRi" "‡≥É")
  ("R^i" "‡≥É")
  ("LLi" "‡≥¢")
  ("L^i" "‡≥¢")
  ("e" "‡≥Ü")
  ("E" "‡≥á")
  ("ee" "‡≥á")
  ("ai" "‡≥à")
  ("o" "‡≥ä")
  ("O" "‡≥ã")
  ("oo" "‡≥ã")
  ("au" "‡≥å")
  ("RR" "‡≥Ñ")
  ("RRI" "‡≥Ñ")
  ("R^I" "‡≥Ñ")
  ("LLI" "‡≥Ñ")
  ("L^I" "‡≥Ñ")
  (";" "‡≥ç")
  (".h" "‡≥ç")
  ) ; dependent end

 (danda
  ("." "‡•§")
  (".." "‡•§")
  (".," "‡••")
  (". " "‡•§" (pushback 1))
  ((?. Return) "‡•§" (pushback 1))
  ((?. Tab) "‡•§" (pushback 1))
  (".(" "‡•§" (pushback 1))
  (".)" "‡•§" (pushback 1))
  (".[" "‡•§" (pushback 1))
  (".]" "‡•§" (pushback 1))
  (".{" "‡•§" (pushback 1))
  (".}" "‡•§" (pushback 1))
  (".'" "‡•§" (pushback 1))
  (".\"" "‡•§" (pushback 1))) ; danda ends

 (commit-key
  ((S-C-Return)))

 (backspace
  ((BackSpace) (undo)))

 (misc
  ("//" "/")
  ("/..." "‚Ä¶")
  ("/." "‡•∞")
  ("/>" "‚Üí")
  ("/<" "‚Üê")
  ("/\\" "üôè")
  ) ;misc ends
  ) ; map ends

(state
 (state_init
  (non_init_keys (pushback 1) (shift state_indic_letter))
  (udattta)
  (misc)
  (digit)
  (commit-key)
  )

 (state_indic_letter
  (consonant (shift state_consonant_pressed))
  (ayogavAhas_with_consonant (shift state_consonant_pressed))
  (consonant_with_space (shift state_init))
  (consonant_with_viraama (shift state_init))
  (independent (shift state_init))
  (danda (shift state_init))
  (backspace)
  (ayogavAhas (shift state_init))
  )

 (state_consonant_pressed
  (consonant)
  (ayogavAhas_with_consonant)
  (consonant_with_space (shift state_init))
  (consonant_with_viraama (shift state_init))
  (dependent (shift state_init))
  (danda (shift state_init))
  (backspace)
  (ayogavAhas (shift state_init))
  )
) ; state ends

;; Local Variables:
;; coding: utf-8
;; mode: emacs-lisp
;; End:
